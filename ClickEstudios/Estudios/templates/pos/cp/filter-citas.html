{% load humanize %}



<script>
document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('buscador').addEventListener('input', function() {
            SearchCita();
      });

      function SearchCita() {
            document.querySelector('.result-citas').innerHTML = ''
            $.ajax({
                  url: '/ajax/search-citas/',
                  method: 'GET',
                  data: {
                        'search': document.getElementById('buscador').value,
                  },
                  success: function(citas) {
                        citas.forEach(function(cita) {
                              const container = document.createElement('div');
                       
                              container.innerHTML = `
                  <div data-aos="fade-left"  style="
                        border: 2px solid #2f2f2f;color: #ffffffcf ;
                        height: max-content; max-width: 410px; 
                        border-radius: 2.5rem; cursor: pointer; " class='  m-2 w-100 p-2 container-sale ms-0 shadow-sm    position-relative bg-white bg-opacity-10'>

                        <a href="">
                              <i class="fi fi-sr-delete position-absolute d-none top-0 end-0" style="font-size: 24px;"></i>
                        </a>

                        <div class="d-flex justify-content-end position-absolute flex-wrap align-content-center    bottom-0 end-0 "
                              style='margin-right: 8rem; margin-bottom: 1.2rem;'>
                              {% if cita.date_choice == today %}
                                    {% if cita.time == time_now %}
                                          <span class="rounded-circle" style="width: 10px; height: 10px; background-color: #ffc107;"></span>  
                                    {% endif %}
                                    {% if cita.time > time_now %}
                                          <span class="rounded-circle" style="width: 10px; height: 10px; background-color:rgb(255, 255, 255);"></span>  
                              {% endif %}
                              {% if cita.time < time_now %}
                                    <span class="rounded-circle" style="width: 10px; height: 10px; background-color:rgb(109, 255, 236);"></span>
                              {% endif %}
                        {% endif %}
                        {% if cita.date_choice < today %}
                              <span class="rounded-circle" style="width: 10px; height: 10px; background-color: rgb(255, 0, 0);"></span>
                              <span class="rounded-circle ms-1" style="width: 10px; height: 10px; background-color:rgb(255, 170, 0);"></span>
                        {% endif %}
                  </div>
                        <div class='d-flex flex-wrap w-100' >
                              <a class="position-relative d-flex">
                                    <div class="d-flex flex-wrap align-content-center">
                                          {% if cita.img %}
                                          <img src="{{cita.img.url}}" 
                                                style='width: 70px; height: 70px;' class='rounded-circle object-fit-cover mt-1 ms-2 me-3'>
                                          {% else %}
                                                <i class="bi bi-file-earmark-image-fill mt-3 ms-3" 
                                                style="font-size: 30px;"></i>
                                          {% endif %}
                                    </div>
                                    <div class="d-flex flex-wrap align-content-center">
                                          <strong style='font-size: 16px; text-transform: uppercase; '>
                                                {{cita.name_plan}}
                                          </strong>
                                          <span class="w-100" style="font-size: 14px;">
                                                RD${{ cita.price_plan|intcomma }}.00
                                          </span>
                                    </div>
                              </a>
                              <span class='w-100 mt-4 ps-3 datos-cliente' >
                                           <p class="mb-0">
                                          <strong class="text-capitalize " style="font-weight: bold; font-size: 20px;">
                                                {% if cita.is_cliente %}
                                                      {{ cita.name }} 
                                                {% else %}
                                                {% if cita.name_client %}
                                                      {{ cita.name_client|slice:":20" }}
                                                {% endif %}
                                                </strong>
                                          </p>
                                          <p class="mb-0 ">
                                                <strong>
                                                      <i class="fi fi-sc-phone-flip"></i>
                                                </strong> 
                                                {% if cita.phone_client %}
                                                      {{ cita.phone_client }} 
                                                {% else %}
                                                      (000) 000-0000 
                                                {% endif %}
                                          </p>
                                          <p class="mb-1">
                                                <strong>
                                                      <i class="fi fi-sr-envelope"></i>
                                                </strong> 
                                                {% if cita.email_client %}
                                                      {{ cita.email_client|slice:":49" }}
                                                {% else %}
                                                      @gmail.com
                                                {% endif %}
                                          </p>
                                          <p class="mb-1">
                                                <strong>
                                                      <i class="fi fi-sr-daily-calendar"></i>
                                                </strong> 
                                                {% if cita.date_choice %}
                                                            {{ cita.date_choice|date:"d/m/Y" }} -  {{ s.time }}
                                                      {% else %}
                                                            .../.../.../
                                                {% endif %}
                                          </p>
                                    <div class='calendary{{s.id}} d-none position-absolute top-0 start-0 blur-20 bg-black bg-opacity-25 rounded-5   d-flex justify-content-center align-content-center flex-wrap '
                                          style="width: 10rem; height: 10rem;">
                                          {% if cita.date_choice %}
                                                <strong class="mb-3 text-white-50">
                                                      {{ cita.date_choice|date:"F" }} 
                                                </strong>
                                                <span class="text-white text-center p-2 ps-0 w-100" style="font-size: 90px; line-height:40px;">
                                                      {{ cita.date_choice|date:"d" }} 
                                                </span>
                                          {% endif %}
                                    </div>
                              </span>
                                
                              {% endif %}
                        </div>

                        <div class='d-flex justify-content-center ms-2 mt-3 '>
                              <span class=" w-100 d-flex  align-content-center text-white-50">
                                    {% if cita.is_reserve %}
                                          {% if cita.debit_mount  != 0 %}
                                                <span class="estado-monto rounded-end-3"><strong 
                                                      style="font-size: 12px;">Debe:  </strong> 
                                                      ${{ cita.debit_mount }}.00</span>
                                                <span class="estado-monto rounded-start-3">
                                                      <strong  style="font-size: 12px;">
                                                            Abon√≥:
                                                      </strong>
                                                            ${{ cita.mount }}.00
                                                      </span>
                                          {% endif %}
                                    {% endif %} 
                              </span>
                              {% if s.payment %}
                                    <a href="">
                                          <button id='reserve-{{ s.id }}'  class="bg-warning rounded-start-5 border-0 rounded-end-5 p-2 me-2 ps-3 pe-3  text-black " style="font-weight: bold; font-size: 14px;">
                                                Teminar
                                          </button>
                                    </a>
                              {% else %}
                                    <a href="" class="m-1">
                                          <button id='reserve-{{ s.id }}' 
                                                class="text-white  border-0 rounded-4 p-2 ps-3 pe-3 " style="font-weight: bold; font-size: 12px; 
                                                background-color: #2f2f2f; border: 1px solid #5b5b5b86;">
                                                {% if cita.is_reserve == True %} 
                                                      Completar {% else %}  Reservar
                                                {% endif %}
                                          </button>
                                    </a>
                              {% endif %}
                        </div>
            </div>
                                
                              `;

                              document.querySelector('.result-citas').appendChild(container)
                              // Append to the desired parent element
                        });
                  },
                  error: function(error) {
                        console.error('Error fetching citas:', error);
                  }
            });
      }
});
</script>