{% extends "base/base.html" %}
{% block content %}
{% load humanize %}
      <style>
            .nav .asistente {
                  color: #ffc107;
                  font-weight: bolder;
                  transform: scale(1.1);
            }
            .nav .asistente svg {
                  color: #ffc107 !important;
            }
            .nav .asistente span {
                  color: #ffc107;
            }
            .btn-atras {
                  display: none;
            }
            .asistente-input {
                  display: none;
            }
            #asistente-input-0 {
            }
            #asistente-input-0:focus {
                  /* background-color: #ffc107 !important; */
                  /* color: black !important; */
            }
            .asistent-response {
                  color: #fefefed3;
            }
            .asistent-response h4{
                  color: #ffc107 !important;
                  font-weight: bolder;
                  width: 100%;
                  margin-top: 2rem;
            }
            .asistent-response strong {
                  color: #ffffff !important;
                  width: 100%;
            }
            /* .asistent-response ul {
                  color: rgb(255, 69, 69) !important;
            }
            .asistent-response li {
                  color: #42ef4e !important;
            } */
      </style>
      <section class="w-100 d-flex flex-wrap justify-content-center align-content-end vh-100 ">
            <div style="max-width: 90%; height: 50vh;" class="w-100 text-white">
                  <h5 class="your-response">
                  </h5>
                  <div class="asistent-response d-flex flex-wrap justify-content-start">

                  </div>
            </div>
            <div class="w-100 d-flex flex-wrap justify-content-center align-content-center">
                  <input type="text" name="" id="asistente-input-0" class="w-100 p-3  rounded-5  mt-5 mb-3 bg-white bg-opacity-10 border-0  text-white text-center"  value="Hi 👋, ¡Buenos dias!" 
                  style="max-width: 19rem; outline: none;">
            </div>
      </section>
      <script>
            let asistente = document.getElementById('asistente-input-0');
            // window.onload = function() {
            //       setTimeout(() => {
            //             asistente.value = "¿En qué puedo ayudarte?";
            //       }, 2000);
            //       setTimeout(() => {
            //             asistente.value = "Puedes preguntarme lo que quieras";
            //       }, 4000);
            //       setTimeout(() => {
            //             asistente.value = "";
            //             asistente.focus();
            //       }, 6000);
            // }
            asistente.addEventListener('keyup', function(e) {
                  if (e.key === 'Enter') {
                        let content = asistente.value;
                        QuestionGemini(content);
                  }
            });

            function FormaTextIA(texto) {
                              const lineas = texto.split('\n');
                              let resultado = '';
                              let listaAbierta = false;

                              lineas.forEach(linea => {
                                    // Si es un encabezado (por ejemplo, "**Título:**")
                                    if (linea.startsWith('**') && linea.endsWith(':**')) {
                                          resultado += `<h4>${linea.replace(/\*\*(.*?)\*\*/g, '$1')}</h4>`;
                                    } 
                                    // Si es una lista (empieza con "* ")
                                    else if (linea.startsWith('* ')) {
                                          if (!listaAbierta) {
                                          resultado += '<ul>';
                                          listaAbierta = true;
                                          }
                                          resultado += `<li>${linea.substring(2).replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</li>`;
                                    } 
                                    // Si es texto normal
                                    else if (linea.trim() !== '') {
                                          if (listaAbierta) {
                                          resultado += '</ul>';
                                          listaAbierta = false;
                                          }
                                          resultado += `<p>${linea.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</p>`;
                                    }
                              });

                              // Cierra la lista si quedó abierta
                              if (listaAbierta) {
                                    resultado += '</ul>';
                              }

                              return resultado;

            }

        

            
            window.onload = function() {
               document.querySelector('.asistent-response').innerHTML=    FormaTextIA('**Generación de texto:**  *  **Responder preguntas de manera informativa y completa,** incluso si son abiertas, desafiantes o extrañas.  * **Generar diferentes formatos de texto creativo** de textos como poemas, código, guiones, piezas musicales, correo electrónico, cartas, etc. Intentaré cumplir con todos tus requisitos.*  **Traducir idiomas.**   * **Resumir textos.**  *  **Escribir diferentes tipos de contenido,** como artículos, publicaciones de blog, historias, descripciones de productos, etc. **Otras habilidades:**   * **Generar ideas.**   * **Proporcionar información sobre una amplia gama de temas.**    * **Ayudar con tareas de investigación.**   *  **Resolver problemas.***   **Simular conversaciones.***   **Seguir tus instrucciones y completar tus peticiones cuidadosamente.**`;')
            }





            function QuestionGemini(question) {
                  $.ajax({
                        url: '{% url "asistente:question_gemini" %}',
                        data: {
                        question: question,},
                        success: function (data) {
                              document.querySelector('.your-response').innerHTML = data.your_question;
                              document.querySelector('.asistent-response').innerHTML = FormaTextIA(data.asistent_response) ;
                        },
                        error: function (data) {

                        }
                  }); 
            }
      </script>
{% endblock  %}